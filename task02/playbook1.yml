---
- hosts: nodes
  vars:
   userlist:
    alice:
     email: Alice@example.com
     homedir: /home/alice
     password: !vault |
          $ANSIBLE_VAULT;1.1;AES256
          63336633323131303238643561333535356262393530313963633737633562366630376363363562
          6162323861633537393139626362653764353466373837340a383034623638386266326637616465
          66623231373136656261623236333835643136353034336434613332633535376530616435636361
          3131616430306532660a316337666332613530336134383831333234326132623465366331376231
          6636
    bob:
     email: Bob@example.com
     homedir: /home/bob
     password: !vault |
          $ANSIBLE_VAULT;1.1;AES256
          64663834313439646639643662663534363763633836323837363130663163616631383030363166
          6461643132613464643563623539376237353233336437330a373336346466383338386134613131
          32386161376337373361646138383432613632343639313738623737396330653865353363316334
          6330363837313963630a343761323938656438356537626434633139363132323731633165313762
          3738
    carol:
     email: Carol@example.com
     homedir: /home/carol
     password: !vault |
          $ANSIBLE_VAULT;1.1;AES256
          66356661356337663538353664316537643137613765623965343335333639303631663833323732
          3764613763316666663561313333623038653533663965320a353833363435373639396563306333
          30646433336463316565333236653635343932656635303562386334643735383330303136646437
          6561303132616535630a663963336665393661323834626537373238303738336335303333653633
          6637
  tasks:
  - name: Adding users
    user:
      update_password: on_create
      create_home: yes
      state: present
      name: "{{item.key}}"
      comment: "{{item.value.email}}"
      home: "{{item.value.homedir}}"
      password: "{{item.value.password | password_hash('sha512') }}"
    with_dict: "{{ userlist }}"
